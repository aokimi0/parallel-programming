# MPIå¹¶è¡Œæ•°è®ºå˜æ¢(NTT)å®ç°

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Language: C++](https://img.shields.io/badge/Language-C%2B%2B-blue.svg)](https://isocpp.org/)
[![MPI](https://img.shields.io/badge/MPI-OpenMPI-green.svg)](https://www.open-mpi.org/)

åŸºäºæ¶ˆæ¯ä¼ é€’æ¥å£(MPI)çš„é«˜æ€§èƒ½å¹¶è¡Œæ•°è®ºå˜æ¢(Number Theoretic Transform, NTT)ç®—æ³•å®ç°ï¼Œé›†æˆBarrettæ¨¡çº¦ç®€ä¼˜åŒ–æŠ€æœ¯ï¼Œé€‚ç”¨äºå¤§è§„æ¨¡å¤šé¡¹å¼ä¹˜æ³•å’Œå¯†ç å­¦è®¡ç®—ã€‚

## é¡¹ç›®æ¦‚è¿°

æ•°è®ºå˜æ¢(NTT)æ˜¯å¿«é€Ÿå‚…é‡Œå¶å˜æ¢(FFT)åœ¨æœ‰é™åŸŸä¸Šçš„æ‰©å±•ï¼Œåœ¨ç°ä»£å¯†ç å­¦ã€åŒæ€åŠ å¯†å’Œé«˜æ•ˆå¤šé¡¹å¼ä¹˜æ³•ç­‰é¢†åŸŸå…·æœ‰é‡è¦åº”ç”¨ã€‚æœ¬é¡¹ç›®å®ç°äº†åŸºäºMPIçš„å¹¶è¡ŒNTTç®—æ³•ï¼Œé€šè¿‡Barrettæ¨¡çº¦ç®€ç­‰ä¼˜åŒ–æŠ€æœ¯æ˜¾è‘—æå‡è®¡ç®—æ•ˆç‡ã€‚

### ä¸»è¦ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½å¹¶è¡Œè®¡ç®—**: åŸºäºMPIå®ç°çš„å¹¶è¡ŒNTTç®—æ³•ï¼Œæœ€é«˜åŠ é€Ÿæ¯”è¾¾2.22å€
- ğŸ”§ **Barrettæ¨¡çº¦ç®€ä¼˜åŒ–**: é‡‡ç”¨é«˜æ•ˆçš„æ¨¡è¿ç®—ä¼˜åŒ–ï¼Œé¿å…é™¤æ³•è¿ç®—ç“¶é¢ˆ
- ğŸŒ **è·¨å¹³å°å…¼å®¹**: æ”¯æŒx86å’ŒARMæ¶æ„ï¼Œåœ¨å¤šç§æœåŠ¡å™¨ç¯å¢ƒä¸‹éªŒè¯
- ğŸ“Š **å…¨é¢æ€§èƒ½æµ‹è¯•**: æ¶µç›–å¤šç§æ¨¡æ•°ã€æ•°æ®è§„æ¨¡å’Œè¿›ç¨‹é…ç½®çš„ç³»ç»Ÿæ€§æµ‹è¯•
- ğŸ¯ **ç²¾ç¡®ç»“æœ**: é¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ï¼Œç¡®ä¿è®¡ç®—ç»“æœçš„å‡†ç¡®æ€§

## æŠ€æœ¯äº®ç‚¹

### ç®—æ³•ä¼˜åŒ–
- **Barrettæ¨¡çº¦ç®€**: é¢„è®¡ç®—ä¼˜åŒ–å¸¸æ•°ï¼Œå°†é™¤æ³•è½¬æ¢ä¸ºä¹˜æ³•å’Œä½ç§»æ“ä½œ
- **ä¸»ä»å¹¶è¡Œæ¨¡å¼**: ç»“åˆç‚¹å€¼ä¹˜æ³•å¹¶è¡ŒåŒ–ï¼Œå¹³è¡¡è®¡ç®—æ•ˆç‡å’Œé€šä¿¡å¼€é”€
- **å†…å­˜è®¿é—®ä¼˜åŒ–**: ä¼˜åŒ–æ•°æ®å¸ƒå±€ï¼Œæé«˜ç¼“å­˜å‘½ä¸­ç‡

### æ€§èƒ½è¡¨ç°
- åœ¨æ•°æ®è§„æ¨¡10000æ—¶ï¼Œ2è¿›ç¨‹é…ç½®å®ç°2.12å€åŠ é€Ÿæ¯”
- åœ¨æ•°æ®è§„æ¨¡1000æ—¶ï¼Œæœ€é«˜è¾¾åˆ°2.22å€åŠ é€Ÿæ¯”
- æ”¯æŒ1000ã€10000ã€100000ç­‰å¤šç§æ•°æ®è§„æ¨¡
- æµ‹è¯•è¦†ç›–1ã€2ã€4ã€8ä¸ªè¿›ç¨‹é…ç½®

## ç›®å½•ç»“æ„

```
.
â”œâ”€â”€ src/                    # æºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ common_mpi_ntt.h   # MPI NTTæ ¸å¿ƒå¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ common_mpi_ntt.cpp # MPI NTTæ ¸å¿ƒå®ç°
â”‚   â”œâ”€â”€ ntt_mpi.cpp        # ä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ Makefile           # ç¼–è¯‘é…ç½®
â”‚   â””â”€â”€ *.sh               # æµ‹è¯•è„šæœ¬
â”œâ”€â”€ src-arm/               # ARMå¹³å°æºç 
â”œâ”€â”€ fig/                   # å®éªŒå›¾è¡¨
â”‚   â”œâ”€â”€ mpi_performance.png
â”‚   â”œâ”€â”€ test.png
â”‚   â””â”€â”€ NKU.png
â”œâ”€â”€ style/                 # LaTeXæ ·å¼æ–‡ä»¶
â”œâ”€â”€ main.tex              # å®éªŒæŠ¥å‘Š
â”œâ”€â”€ reference.bib         # å‚è€ƒæ–‡çŒ®
â””â”€â”€ README.md             # é¡¹ç›®è¯´æ˜
```

## ç¯å¢ƒè¦æ±‚

### ç³»ç»Ÿç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**: Linux (æ¨èUbuntu 20.04+)
- **ç¼–è¯‘å™¨**: g++ (æ”¯æŒC++17æ ‡å‡†)
- **MPIå®ç°**: OpenMPI 4.0+
- **æ¶æ„æ”¯æŒ**: x86_64, ARM64

### è½¯ä»¶ä¾èµ–
```bash
# Ubuntu/Debian
sudo apt update
sudo apt install build-essential
sudo apt install openmpi-bin openmpi-common libopenmpi-dev

# CentOS/RHEL
sudo yum groupinstall "Development Tools"
sudo yum install openmpi openmpi-devel
```

## ç¼–è¯‘å®‰è£…

### 1. å…‹éš†ä»“åº“
```bash
git clone https://github.com/aokimi0/parallel-programming.git
cd parallel-programming
```

### 2. ç¼–è¯‘ç¨‹åº
```bash
cd src
make
```

### 3. éªŒè¯å®‰è£…
```bash
# ç”Ÿæˆæµ‹è¯•æ•°æ®
./generate_test_data

# è¿è¡Œå•è¿›ç¨‹æµ‹è¯•
mpirun -np 1 ./ntt_mpi < test_input.txt

# è¿è¡Œå¤šè¿›ç¨‹æµ‹è¯•
mpirun -np 2 ./ntt_mpi < test_input.txt
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# è¿è¡ŒMPIå¹¶è¡ŒNTT
mpirun -np <è¿›ç¨‹æ•°> ./ntt_mpi < input_file.txt
```

### è¾“å…¥æ ¼å¼
```
<å¤šé¡¹å¼ç³»æ•°ä¸ªæ•°> <æ¨¡æ•°>
<å¤šé¡¹å¼Açš„ç³»æ•°>
<å¤šé¡¹å¼Bçš„ç³»æ•°>
```

### ç¤ºä¾‹
```bash
# åˆ›å»ºè¾“å…¥æ–‡ä»¶
echo "4 7340033" > input.txt
echo "1 2 3 4" >> input.txt
echo "5 6 7 8" >> input.txt

# è¿è¡Œ2è¿›ç¨‹å¹¶è¡Œè®¡ç®—
mpirun -np 2 ./ntt_mpi < input.txt
```

### æ€§èƒ½æµ‹è¯•

```bash
# è¿è¡Œå®Œæ•´æ€§èƒ½æµ‹è¯•
cd src
./test_performance.sh

# è¿è¡Œæ­£ç¡®æ€§æµ‹è¯•
./correctness_test.sh
```

## æ€§èƒ½åŸºå‡†

### æµ‹è¯•ç¯å¢ƒ
- **å¹³å°**: WSL Ubuntu 24.04 (x86_64)
- **å¤„ç†å™¨**: Intel/AMD å¤šæ ¸å¤„ç†å™¨
- **MPI**: OpenMPI 4.1.x
- **ç¼–è¯‘å™¨**: g++ 11.x

### æ€§èƒ½æ•°æ®

| æ¨¡æ•° | æ•°æ®è§„æ¨¡ | 1è¿›ç¨‹(Î¼s) | 2è¿›ç¨‹(Î¼s) | 4è¿›ç¨‹(Î¼s) | 8è¿›ç¨‹(Î¼s) | æœ€ä½³åŠ é€Ÿæ¯” |
|------|----------|-----------|-----------|-----------|-----------|------------|
| 7340033 | 1000 | 119.60 | 599.44 | 176.35 | 1082.27 | 0.68 |
| 7340033 | 10000 | 10764.4 | 5089.28 | 5723.23 | 7585.11 | **2.12** |
| 7340033 | 100000 | 50611.3 | 36636.7 | 49637.8 | 68674.0 | **1.38** |
| 104857601 | 1000 | 316.33 | 142.31 | 196.10 | 5842.52 | **2.22** |

## ç®—æ³•åŸç†

### æ•°è®ºå˜æ¢åŸºç¡€
NTTåŸºäºæ¨¡åŸŸä¸­çš„åŸæ ¹æ€§è´¨ï¼Œå°†å¤šé¡¹å¼ä¹˜æ³•è½¬æ¢ä¸ºç‚¹å€¼ä¹˜æ³•ï¼š

```
å‰å‘å˜æ¢: Y_k = Î£(j=0 to n-1) X_j * Ï‰_n^(jk) mod p
é€†å‘å˜æ¢: X_j = n^(-1) * Î£(k=0 to n-1) Y_k * Ï‰_n^(-jk) mod p
```

### Barrettæ¨¡çº¦ç®€
ä¼˜åŒ–æ¨¡è¿ç®—ï¼Œé¿å…é™¤æ³•æ“ä½œï¼š
```
x mod q â‰ˆ x - âŒŠxr/2^kâŒ‹ * q
å…¶ä¸­ r = âŒŠ2^k/qâŒ‹ ä¸ºé¢„è®¡ç®—å¸¸æ•°
```

### å¹¶è¡Œç­–ç•¥

1. **ä¸»ä»NTTè®¡ç®—**: ä¸»è¿›ç¨‹æ‰§è¡ŒNTTå˜æ¢ï¼Œå¹¿æ’­ç»“æœ
2. **ç‚¹å€¼ä¹˜æ³•å¹¶è¡Œ**: å„è¿›ç¨‹å¹¶è¡Œå¤„ç†ç‚¹å€¼ä¹˜æ³•ï¼Œèšåˆç»“æœ

## åº”ç”¨åœºæ™¯

- **å¯†ç å­¦**: RSAã€æ¤­åœ†æ›²çº¿å¯†ç å­¦ä¸­çš„å¤§æ•´æ•°è¿ç®—
- **åŒæ€åŠ å¯†**: éšç§ä¿æŠ¤è®¡ç®—ä¸­çš„å¤šé¡¹å¼è¿ç®—
- **ä¿¡å·å¤„ç†**: æ•°å­—æ»¤æ³¢å™¨è®¾è®¡å’Œé¢‘åŸŸåˆ†æ
- **è®¡ç®—æ•°å­¦**: é«˜ç²¾åº¦æ•°å€¼è®¡ç®—å’Œç¬¦å·è®¡ç®—

## å®éªŒæŠ¥å‘Š

è¯¦ç»†çš„æ€§èƒ½åˆ†æå’ŒæŠ€æœ¯æŠ¥å‘Šè¯·å‚è§ [å®éªŒæŠ¥å‘Š](lab4_mpi.pdf)

## ç›¸å…³é¡¹ç›®

[lab3-pthread](lab3-pthread/) - å¤šçº¿ç¨‹NTTå®ç°å‚è€ƒ 